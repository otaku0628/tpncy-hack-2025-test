<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Detection Demo</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/camera.css">
</head>
<body>
<div class="container">
    <h1>Barcode Detection Demo</h1>

    <div>
        <h2>Supported Formats:</h2>
        <div id="supportedFormats" class="results"></div>
    </div>

    <div>
        <h2>Camera Feed</h2>
        <div class="video-container">
            <video id="video" autoplay playsinline></video>
        </div>
        <div class="controls">
            <button id="startCamera">Start Camera</button>
            <button id="stopCamera">Stop Camera</button>
        </div>
        <div class="camera-results">
            <div id="currentBatch" class="result-box current-batch"></div>
            <div id="attempt1" class="result-box attempt-box"></div>
            <div id="attempt2" class="result-box attempt-box"></div>
            <div id="attempt3" class="result-box attempt-box"></div>
        </div>
        <div id="actionButtons" class="action-buttons">
            <button id="redirectButton" class="redirect-button">Go to Product</button>
            <a id="redirectLink" class="redirect-link" href="#"></a>
        </div>
    </div>

    <div>
        <h2>Image Upload</h2>
        <input type="file" id="imageInput" accept="image/*">
        <img id="imagePreview" style="display: none;">
        <div class="results" id="imageResults"></div>
        <div id="imageActionButtons" class="action-buttons">
            <button id="imageRedirectButton" class="redirect-button">Go to Product</button>
            <a id="imageRedirectLink" class="redirect-link" href="#"></a>
        </div>
    </div>
</div>

<!-- Register barcode detector polyfill -->
<script type="module" src="https://fastly.jsdelivr.net/npm/barcode-detector@3/dist/es/polyfill.min.js"></script>

<!-- Main script -->
<script type="module">
    // Wait for polyfill to load
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    import { initializeBarcodeDetector } from './js/initialize.js';
    import { startCamera, stopCamera } from './js/camera-handler.js';
    import { handleImageUpload } from './js/image-handler.js';
    
    document.addEventListener('DOMContentLoaded', () => {
        initializeBarcodeDetector();
        document.getElementById('startCamera').addEventListener('click', startCamera);
        document.getElementById('stopCamera').addEventListener('click', stopCamera);
        document.getElementById('imageInput').addEventListener('change', handleImageUpload);
    });
</script>
</body>
</html>
